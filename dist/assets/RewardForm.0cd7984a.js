var Y=Object.defineProperty,G=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var $=(t,o,e)=>o in t?Y(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,b=(t,o)=>{for(var e in o||(o={}))W.call(o,e)&&$(t,e,o[e]);if(j)for(var e of j(o))X.call(o,e)&&$(t,e,o[e]);return t},C=(t,o)=>G(t,J(o));import{c as Z,i as S,R as B,b as ee}from"./index.e9eeb558.js";import{r as _,m as i,ag as m,ac as ae,ad as te,aV as le,az as se,aa as oe,ab as ne,al as re,af as ue,a_ as ie,aj as P,a9 as de,d as ce,k as fe,j as me,i as ve,l as pe,U as be,aY as ge,o as Ve,f as he,n as g,p as u,a as R,u as c,Y as O,a7 as xe,a8 as ke,Q as ye,B as A,N as _e,P as qe}from"./vendor.2cf8fbd6.js";import{Q as we,a as Ce}from"./QForm.8e0a2642.js";function Ie(t,o){const e=_(null),v=i(()=>t.disable!==!0?null:m("span",{ref:e,class:"no-outline",tabindex:-1}));function V(d){const l=o.value;d!==void 0&&d.type.indexOf("key")===0?l!==null&&document.activeElement!==l&&l.contains(document.activeElement)===!0&&l.focus():e.value!==null&&(d===void 0||l!==null&&l.contains(d.target)===!0)&&e.value.focus()}return{refocusTargetEl:v,refocusTarget:V}}var Qe={xs:30,sm:35,md:40,lg:50,xl:60};const je=C(b(b(b({},oe),ne),re),{modelValue:{required:!0,default:null},val:{},trueValue:{default:!0},falseValue:{default:!1},indeterminateValue:{default:null},toggleOrder:{type:String,validator:t=>t==="tf"||t==="ft"},toggleIndeterminate:Boolean,label:String,leftLabel:Boolean,color:String,keepColor:Boolean,dense:Boolean,disable:Boolean,tabindex:[String,Number]}),$e=["update:modelValue"];function Se(t,o){const{props:e,slots:v,emit:V,proxy:d}=ue(),{$q:l}=d,f=ae(e,l),p=_(null),{refocusTargetEl:k,refocusTarget:q}=Ie(e,p),r=te(e,Qe),s=i(()=>e.val!==void 0&&Array.isArray(e.modelValue)),h=i(()=>s.value===!0?e.modelValue.indexOf(e.val):-1),n=i(()=>s.value===!0?h.value>-1:e.modelValue===e.trueValue),y=i(()=>s.value===!0?h.value===-1:e.modelValue===e.falseValue),I=i(()=>n.value===!1&&y.value===!1),N=i(()=>e.disable===!0?-1:e.tabindex||0),T=i(()=>`q-${t} cursor-pointer no-outline row inline no-wrap items-center`+(e.disable===!0?" disabled":"")+(f.value===!0?` q-${t}--dark`:"")+(e.dense===!0?` q-${t}--dense`:"")+(e.leftLabel===!0?" reverse":"")),U=i(()=>{const a=n.value===!0?"truthy":y.value===!0?"falsy":"indet",x=e.color!==void 0&&(e.keepColor===!0||(t==="toggle"?n.value===!0:y.value!==!0))?` text-${e.color}`:"";return`q-${t}__inner relative-position non-selectable q-${t}__inner--${a}${x}`}),z=i(()=>{const a={type:"checkbox"};return e.name!==void 0&&Object.assign(a,{"^checked":n.value===!0?"checked":void 0,name:e.name,value:s.value===!0?e.val:e.trueValue}),a}),D=ie(z),E=i(()=>{const a={tabindex:N.value,role:"checkbox","aria-label":e.label,"aria-checked":I.value===!0?"mixed":n.value===!0?"true":"false"};return e.disable===!0&&(a["aria-disabled"]="true"),a});function w(a){a!==void 0&&(P(a),q(a)),e.disable!==!0&&V("update:modelValue",M(),a)}function M(){if(s.value===!0){if(n.value===!0){const a=e.modelValue.slice();return a.splice(h.value,1),a}return e.modelValue.concat([e.val])}if(n.value===!0){if(e.toggleOrder!=="ft"||e.toggleIndeterminate===!1)return e.falseValue}else if(y.value===!0){if(e.toggleOrder==="ft"||e.toggleIndeterminate===!1)return e.trueValue}else return e.toggleOrder!=="ft"?e.trueValue:e.falseValue;return e.indeterminateValue}function H(a){(a.keyCode===13||a.keyCode===32)&&P(a)}function L(a){(a.keyCode===13||a.keyCode===32)&&w(a)}const K=o(n,I);return Object.assign(d,{toggle:w}),()=>{const a=K();e.disable!==!0&&D(a,"unshift",` q-${t}__native absolute q-ma-none q-pa-none`);const x=[m("div",{class:U.value,style:r.value},a)];k.value!==null&&x.push(k.value);const Q=e.label!==void 0?le(v.default,[e.label]):se(v.default);return Q!==void 0&&x.push(m("div",{class:`q-${t}__label q-anchor--skip`},Q)),m("div",C(b({ref:p,class:T.value},E.value),{onClick:w,onKeydown:H,onKeyup:L}),x)}}const Be=m("div",{class:"q-checkbox__bg absolute"},[m("svg",{class:"q-checkbox__svg fit absolute-full",viewBox:"0 0 24 24","aria-hidden":"true"},[m("path",{class:"q-checkbox__truthy",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"}),m("path",{class:"q-checkbox__indet",d:"M4,14H20V10H4"})])]);var F=de({name:"QCheckbox",props:je,emits:$e,setup(){return Se("checkbox",()=>()=>[Be])}});const Pe={class:"flex justify-end"},Ne=ce({props:{modelValue:null},emits:["submit"],setup(t,{emit:o}){const e=t,v=fe(),V=me(),{getActiveProfile:d}=Z(),l=ve(e.modelValue||{});pe(()=>{const r=d.value;r&&r.id?Object.assign(l,b({profile:r.id,claimed:!1,active:!1},l)):v.notify({type:"warning",caption:"Please add or activate a profile first",timeout:0,closeBtn:!0,actions:[{label:"Go to Profiles",handler:()=>V.push("/profiles")}]})});const f=_(),p=_();be(f,()=>{const r=new FileReader;r.readAsDataURL(f.value);const s=`${f.value.name}_${Date.now()}`;r.onload=async()=>{await S.setImage(s,r.result),l.image=s}}),ge(async()=>{l.image&&(p.value=await S.getImage(l.image))});function k(){const r=B.safeParse(l);r.success&&o("submit",r.data)}function q(){Object.assign(l,B.parse(e.modelValue)),f.value=null,p.value=null}return(r,s)=>{const h=ee;return Ve(),he(qe,{flat:""},{default:g(()=>[u(_e,null,{default:g(()=>[R("div",null,[u(h,{jsonable:c(l)},null,8,["jsonable"]),u(we,{class:"q-gutter-md",onSubmit:k,onReset:q},{default:g(()=>[u(O,{modelValue:c(l).name,"onUpdate:modelValue":s[0]||(s[0]=n=>c(l).name=n),label:"What is this reward?",required:"",standout:"bg-primary text-secondary"},null,8,["modelValue"]),u(O,{modelValue:c(l).milestone,"onUpdate:modelValue":s[1]||(s[1]=n=>c(l).milestone=n),modelModifiers:{number:!0},type:"number",label:"Target",required:"",standout:"bg-primary text-secondary",hint:"How many points are needed to achieve this reward?"},null,8,["modelValue"]),u(Ce,{modelValue:f.value,"onUpdate:modelValue":s[2]||(s[2]=n=>f.value=n),label:"A picture of the reward",standout:"bg-primary text-secondary"},{prepend:g(()=>[u(xe,{name:"attach_file"})]),append:g(()=>[u(ke,{square:"",size:"90px"},{default:g(()=>[u(ye,{src:p.value},null,8,["src"])]),_:1})]),_:1},8,["modelValue"]),u(F,{modelValue:c(l).claimed,"onUpdate:modelValue":s[3]||(s[3]=n=>c(l).claimed=n),label:"Have they received this reward already?"},null,8,["modelValue"]),u(F,{modelValue:c(l).active,"onUpdate:modelValue":s[4]||(s[4]=n=>c(l).active=n),label:"Is this the current goal?"},null,8,["modelValue"]),R("div",Pe,[u(A,{label:"Reset",type:"reset",color:"primary",flat:"",class:"q-ml-sm"}),u(A,{label:"Submit",type:"submit",color:"primary"})])]),_:1})])]),_:1})]),_:1})}}});export{Ne as _};
